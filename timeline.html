<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Patrick E. McKnight">

<title>Timeline of Moral Judgment and Psychopathy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="timeline_files/libs/clipboard/clipboard.min.js"></script>
<script src="timeline_files/libs/quarto-html/quarto.js"></script>
<script src="timeline_files/libs/quarto-html/popper.min.js"></script>
<script src="timeline_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="timeline_files/libs/quarto-html/anchor.min.js"></script>
<link href="timeline_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="timeline_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="timeline_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="timeline_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="timeline_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Timeline of Moral Judgment and Psychopathy</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Patrick E. McKnight </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>The following lists key events in the history of moral judgment and psychopathy, from ancient times to the present day. This timeline is not exhaustive, but it highlights important developments in the understanding of moral reasoning, criminal responsibility, and psychopathic behavior. NB: This timeline is a work in progress and will be updated with additional information and references. Some of the content may be generated by AI and should be reviewed for accuracy.</p>
<section id="ancient-times---17th-century" class="level2">
<h2 class="anchored" data-anchor-id="ancient-times---17th-century">Ancient Times - 17th Century</h2>
<ul>
<li><strong>Pre-900 BC</strong>: Belief that liars exhibit physical signs like shivering and fidgeting (Vrij et al., 2019)</li>
<li><strong>Biblical Times</strong>: The Gospel’s challenge to judge (“He that is without sin…”) is seen by some (Kaufman) as addressed by Freud (Diamond, 1961)</li>
<li><strong>17th Century</strong>: Judges explore mens rea, the concept of “guilty mind” (Diamond, 1961)</li>
<li><strong>17th Century</strong>: Sir Matthew Hale explores the nature of crime and responsibility, including consideration of witchcraft (Diamond, 1961)</li>
</ul>
</section>
<section id="th---19th-century" class="level2">
<h2 class="anchored" data-anchor-id="th---19th-century">18th - 19th Century</h2>
<ul>
<li><strong>18th Century</strong>: Immanuel Kant formulates a strong desert theory of justice, arguing that even if society were dissolving, a murderer should still be executed (Diamantis, 2015)</li>
<li><strong>1837</strong>: James Prichard describes psychopathy as “moral insanity” (Marshall et al., 2018)</li>
<li><strong>1867</strong>: The concept of diminished responsibility is originated in Scotland (Diamond, 1961)</li>
<li><strong>1869</strong>: The New Hampshire Rule for insanity is established in State v. Pike (Diamond, 1961)</li>
<li><strong>Late 19th Century</strong>: Some scholars begin to see psychopaths as “moral monsters” due to their unethical behavior (Marshall et al., 2018)</li>
</ul>
</section>
<section id="early-mid-20th-century" class="level2">
<h2 class="anchored" data-anchor-id="early-mid-20th-century">Early-Mid 20th Century</h2>
<ul>
<li><strong>Early 20th Century</strong>: Sigmund Freud emphasizes unconscious motivations and the breakdown between the normal and abnormal (Diamond, 1961)</li>
<li><strong>1908</strong>: Münsterberg points to the utility of observing posture, eye movements, and knee jerks for lie detection purposes (Vrij et al., 2019)</li>
<li><strong>1929</strong>: Alexander and Staub publish “The Criminal, The Judge and the Public”, a psychoanalytical approach to criminal justice (Diamond, 1961)</li>
<li><strong>1939</strong>: Rudolf Brandt uses the term “Ausrottung” in the context of tuberculosis and later the “accelerated Ausrottung of the Jews”. Hitler issues a “prophecy” about the consequences of “international finance Jewry” leading to war (Shermer, 2002)</li>
<li><strong>1941</strong>: Cleckley’s “The Mask of Sanity” describes the moral deficiency of psychopaths (Marshall et al., 2018)</li>
<li><strong>1948</strong>: Freud’s Gesammelte Werke is published (Diamond, 1961)</li>
<li><strong>1954</strong>: The Durham Rule for insanity is established in Durham v. United States (Diamond, 1961)</li>
<li><strong>1950s-1960s</strong>: The concept of ‘mens rea’ is seen as capable of evolving to provide an effective bridge between psychiatry and the law (Diamond, 1961). Henry Hart Jr.&nbsp;describes the criminal sanction as carrying a judgment of community condemnation (Diamantis, 2015)</li>
<li><strong>1958</strong>: Roche publishes The Criminal Mind (Diamond, 1961)</li>
<li><strong>1960</strong>: Miller, Galanter, &amp; Pribram write about a valuation system of internal and external reality (Gross, 2015)</li>
<li><strong>1961</strong>: A psychiatrist argues that the M’Naghten Rule forces them to be “puppet doctors” for the law, or to perjure themselves (Diamond, 1961)</li>
<li><strong>1962</strong>: A comparison is made between children and early scientists and their approaches to discovery (Shermer, 2002)</li>
</ul>
</section>
<section id="late-20th-century" class="level2">
<h2 class="anchored" data-anchor-id="late-20th-century">Late 20th Century</h2>
<ul>
<li><strong>1974</strong>: Rest, Cooper, Coder, Masanz, &amp; Anderson develop the Defining Issues Test (DIT) as a measure of Kohlberg’s moral reasoning framework (Marshall et al., 2018)</li>
<li><strong>1983</strong>: Jerry Fodor publishes “The Modularity of Mind” (Diamantis, 2015)</li>
<li><strong>1990s</strong>: The idea of “mental modules” is popularized as specialized computational devices in the mind (Shermer, 2002)</li>
<li><strong>1990s</strong>: Psychopathy is associated with impaired moral judgment in various studies, including use of the Levenson Self-Report Psychopathy Scale (LSRP), Psychopathy Checklist - Revised (PCL-R), and Moral Foundations Questionnaire (MFQ) (Marshall et al., 2018)</li>
<li><strong>1995</strong>: Levenson, Kiehl, &amp; Fitzpatrick, create the Levenson Self-Report Psychopathy Scale (LSRP) (Marshall et al., 2018)</li>
<li><strong>1996</strong>: Lilienfeld and Andrews publish the Psychopathy Personality Inventory (PPI) (Marshall et al., 2018)</li>
<li><strong>Late 1990s</strong>: An operational definition of science is questioned (Trocco, 1998)</li>
<li><strong>Late 1990s</strong>: Some posit that the critical step in evolution of the human mind was a transition from a specialized to a generalized mentality (Shermer, 2002)</li>
</ul>
</section>
<section id="st-century" class="level2">
<h2 class="anchored" data-anchor-id="st-century">21st Century</h2>
<ul>
<li><strong>Early 2000s</strong>: Focus on nonverbal cues in detecting deception, with skepticism about pseudoscientific approaches like facial microexpressions and neurolinguistic programming (Vrij et al., 2019)</li>
<li><strong>Early 2000s</strong>: Meta-analyses of psychopathy and moral judgment reveal a weak, though statistically significant relationship (Marshall et al., 2018)</li>
<li><strong>2010s</strong>: Increased research into the “valuation system” of the mind, relating perceptions and emotional response (Gross, 2015)</li>
<li><strong>2010s</strong>: The role of corporate compliance programs in reducing criminal activity is investigated (Diamantis, 2015)</li>
<li><strong>2010s</strong>: Studies examining the link between moral judgment and psychopathy continue (Marshall et al., 2018)</li>
<li><strong>2019</strong>: Non-verbal cues to deception remain inconsistently reliable (Vrij et al., 2019)</li>
</ul>
</section>
<section id="cast-of-characters" class="level1">
<h1>Cast of Characters</h1>
<section id="philosophers-and-legal-scholars" class="level2">
<h2 class="anchored" data-anchor-id="philosophers-and-legal-scholars">Philosophers and Legal Scholars</h2>
<ul>
<li><strong>Immanuel Kant</strong> (1724-1804): German philosopher; developed a strong theory of desert in punishment, emphasizing moral duty and justice (Diamantis, 2015)</li>
<li><strong>Matthew Hale</strong> (1609-1676): English jurist and Lord Chief Justice; explored concepts of crime, responsibility, and witchcraft (Diamond, 1961)</li>
<li><strong>Henry M. Hart Jr.</strong>: 20th-century legal scholar who described the criminal sanction as expressing community condemnation (Diamantis, 2015)</li>
<li><strong>Samuel W. Buell</strong>: Legal scholar on corporate criminal liability (Diamantis, 2015)</li>
<li><strong>Peter J. Henning</strong>: Commentator on Corporate Criminal Liability (Diamantis, 2015)</li>
<li><strong>Bernard E. Harcourt</strong>: Commentator on the expressive function of punishment (Diamantis, 2015)</li>
</ul>
</section>
<section id="psychologists-and-researchers" class="level2">
<h2 class="anchored" data-anchor-id="psychologists-and-researchers">Psychologists and Researchers</h2>
<ul>
<li><strong>James Prichard</strong> (1786-1848): British physician; characterized psychopathy as “moral insanity” (Marshall et al., 2018)</li>
<li><strong>Sigmund Freud</strong> (1856-1939): Austrian neurologist and founder of psychoanalysis; emphasized unconscious motivations and the breakdown between normal and abnormal behaviors (Diamond, 1961)</li>
<li><strong>Münsterberg</strong> (1863-1916): German-American psychologist; early advocate for using observations of posture, eye movements, etc. for lie detection (Vrij et al., 2019)</li>
<li><strong>Lawrence Kohlberg</strong> (1927-1987): American psychologist; developed a theory of moral development stages (Marshall et al., 2018)</li>
<li><strong>James Rest</strong> (1941- ): American psychologist who developed the Defining Issues Test (DIT), a questionnaire based on the Kohlberg’s framework (Marshall et al., 2018)</li>
<li><strong>Robert Hare</strong> (1934- ): Canadian psychologist; developed the Psychopathy Checklist-Revised (PCL-R) (Marshall et al., 2018)</li>
<li><strong>Christopher Lilienfeld</strong> (1959- ): American psychologist; developed the Psychopathic Personality Inventory (PPI) and PPI-Revised (PPI-R) (Marshall et al., 2018)</li>
<li><strong>Aldert Vrij</strong> (1967- ): Dutch psychologist; expert on deception, particularly nonverbal cues to deception (Vrij et al., 2019)</li>
</ul>
</section>
<section id="cognitive-scientists-and-theorists" class="level2">
<h2 class="anchored" data-anchor-id="cognitive-scientists-and-theorists">Cognitive Scientists and Theorists</h2>
<ul>
<li><strong>Jerry A. Fodor</strong> (1935-2017): American philosopher and cognitive scientist; known for his concept of “modularity of mind” (Diamantis, 2015)</li>
<li><strong>Steven Pinker</strong> (1954- ): Canadian-American cognitive psychologist; popularized the idea of “mental modules” as specialized cognitive devices (Shermer, 2002)</li>
<li><strong>Steven Mithen</strong> (1960- ): British archaeologist; proposed the critical step in the evolution of the human mind was a transition from a specialized to a generalized mentality (Shermer, 2002)</li>
<li><strong>Larry Laudan</strong> (1941- ): American philosopher of science; explored the issue of distinguishing reliable from “bogus” knowledge claims (Trocco, 1998)</li>
<li><strong>Bertram F. Malle</strong>: Contemporary researcher into the mental states motivating behavior and how people attribute culpability (Diamantis, 2015)</li>
<li><strong>Paul H. Robinson &amp; John M. Darley</strong>: Researchers into the role of desert in sentencing (Diamantis, 2015)</li>
</ul>
</section>
<section id="historical-figures" class="level2">
<h2 class="anchored" data-anchor-id="historical-figures">Historical Figures</h2>
<ul>
<li><strong>Rudolf Brandt</strong> (1909-1948): SS officer in Nazi Germany, involved in Nazi atrocities, responsible for the use of “Ausrottung” in the context of mass extermination (Shermer, 2002)</li>
<li><strong>Adolf Hitler</strong> (1889-1945): Dictator of Nazi Germany; his beliefs are cited as an example of irrationality and justification for atrocities (Shermer, 2002)</li>
</ul>
</section>
<section id="research-teams-and-collaborators" class="level2">
<h2 class="anchored" data-anchor-id="research-teams-and-collaborators">Research Teams and Collaborators</h2>
<ul>
<li><strong>Alexander &amp; Staub</strong>: Wrote “The Criminal, The Judge and the Public” (1929) a psychoanalytical approach to criminal justice (Diamond, 1961)</li>
<li><strong>Levenson, Kiehl, &amp; Fitzpatrick</strong>: Developers of the Levenson Self-Report Psychopathy Scale (LSRP) (Marshall et al., 2018)</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>